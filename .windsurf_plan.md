# Project Plan (.windsurf_plan.md)

## 2025-11-10

- **[goal]** Consolidate MCP tool registration for maintainability
- **[done]**
  - Finished migrating all `this.server.tool(...)` registrations into `src/include/tools.js`
  - Simplified `MyMCP.init` to delegate to `registerTools` with the correct binding
  - Analyzed Git status and prepared documentation for committing changes on 2025-11-10
- **[next]**
  - Ensure downstream builds (`npm run dev`) succeed after refactor
  - Continue Jira client modularization effort per longer-term plan

## 2025-11-09

- **[goal]** Sync with remote and resolve divergent branches
- **[done]**
  - Reset local branch to match `origin/master` at commit `055d32f`
  - Discarded 4 local commits about comments/boards features (will be re-implemented if needed)
  - Updated frontend dependencies (npm install) - added peer dependencies to package-lock.json
- **[status]** Repository is now synchronized with remote
- **[done]**
  - Created `requests` table with migration 0005_add_requests_table.up.sql
  - Added Request and RequestMetrics models to track API usage
  - Implemented request tracking middleware in backend/internal/middleware/
  - Added store methods for creating and querying request metrics
  - Added API endpoints: /api/metrics/user, /api/metrics/user/requests, /api/metrics/all
  - Fixed all lint errors and updated tests to work with new database parameter
  - Created dbtool to fix dirty database migration states
  - Resolved dirty database version 5 issue successfully
- **[next]**
  - Re-implement any needed comment/boards features that were lost in reset
  - Continue with previous goals from 2025-10-14 if still relevant
  - Add authentication middleware to properly set user_id in context for request tracking
  - Add admin authentication for /api/metrics/all endpoint

## 2025-11-11

- **[goal]** Fix request logging issues and add authentication for MCP secret validation
- **[done]**
  - Added logging to MCP worker in `src/index.ts` for backend requests
  - Implemented `GetUserIDByMCPSecret` in `store.go` and updated middleware in `server.go` for authenticated logging
  - Resolved foreign key constraint errors in request tracking
  - Verified data storage in `requests` table
- **[next]**
  - Monitor for any remaining issues in authenticated request handling
  - Test and refine MCP worker-backend integration

## 2025-10-14

- **[goal]** Expand Jira comment capabilities and reduce number of tool calls required from IDE
- **[done]**
  - Implemented full Jira comment API coverage in our client/facade:
    - List with options, add/update with visibility/properties/flags, delete, get single, get by IDs
  - Extended MCP `jiraIssueToolkit` to support new actions and options
  - Added `listCommentsFull` toolkit action to return raw comments + extracted plain text in a single call
  - Fix `JiraIssues.searchIssues` endpoint: change `/rest/api/3/search/jql` to `/rest/api/3/search`; keep `jql` as query parameter
- **[status]** Implemented fix in `src/tools/jira/client/issues.ts`.
- **[next]**
  - Consider adding `getCommentWithThread` (parent/children) aggregation if needed
  - Address pre-existing `Env` lint (`COOKIE_ENCRYPTION_KEY`) in `src/index.ts`
  - Monitor for search regressions; add tests for `fieldsByKeys`, pagination (`startAt`, `maxResults`).
- **[notes]**
  - Keep interfaces aligned with Jira OpenAPI as we add more endpoints.
